name: Build macOS App (Legacy - 10.13+)

# macOS 10.13+ için eski Electron versiyonuyla build
# 2015-2017 Mac'ler için

on:
  workflow_dispatch:
    inputs:
      electron_version:
        description: 'Electron version (e.g., 22.0.0 for 10.13+)'
        required: false
        default: '22.0.0'

jobs:
  build-macos-legacy:
    runs-on: macos-latest
    
    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '20'
          cache: 'npm'

      - name: Install dependencies
        run: npm ci

      - name: Install legacy Electron
        run: |
          echo "Installing Electron ${{ github.event.inputs.electron_version || '22.0.0' }}"
          npm install --save-dev electron@${{ github.event.inputs.electron_version || '22.0.0' }}

      - name: Rebuild native dependencies
        run: npm run rebuild

      - name: Build Renderer
        run: npm run build:renderer

      - name: Build Electron
        run: npm run build:electron

      - name: Build macOS DMG (Legacy)
        run: npx electron-builder --mac dmg --x64 --publish never
        env:
          CSC_IDENTITY_AUTO_DISCOVERY: false

      - name: Rename DMG for Legacy
        run: |
          cd release
          for file in *.dmg; do
            mv "$file" "${file%.dmg}-legacy.dmg"
          done

      - name: List release files
        run: ls -la release/

      - name: Upload macOS DMG (Legacy)
        uses: actions/upload-artifact@v4
        with:
          name: macos-dmg-legacy-${{ github.event.inputs.electron_version || '22.0.0' }}
          path: release/*-legacy.dmg
          retention-days: 90
          if-no-files-found: error




