name: PR Checks

on:
  pull_request:
    types: [opened, synchronize, reopened]

jobs:
  pr-title-check:
    name: üìù PR Title Check
    runs-on: ubuntu-latest
    steps:
      - name: Check PR title format
        uses: amannn/action-semantic-pull-request@v5
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        with:
          types: |
            feat
            fix
            docs
            style
            refactor
            test
            chore
            ci
            perf
          requireScope: false
          subjectPattern: ^(?![A-Z]).+$
          subjectPatternError: |
            Ba≈ülƒ±k k√º√ß√ºk harfle ba≈ülamalƒ± ve nokta ile bitmemeli.
            √ñrnek: "feat: yeni √∂zellik eklendi"

  pr-size-check:
    name: üìè PR Size Check
    runs-on: ubuntu-latest
    steps:
      - name: Check PR size
        uses: actions/github-script@v7
        with:
          script: |
            const { data: pr } = await github.rest.pulls.get({
              owner: context.repo.owner,
              repo: context.repo.repo,
              pull_number: context.issue.number,
            });
            
            const additions = pr.additions;
            const deletions = pr.deletions;
            const total = additions + deletions;
            
            let label = '';
            if (total < 50) label = 'size/XS';
            else if (total < 200) label = 'size/S';
            else if (total < 500) label = 'size/M';
            else if (total < 1000) label = 'size/L';
            else label = 'size/XL';
            
            // Remove old size labels
            const currentLabels = pr.labels.map(l => l.name);
            const sizeLabels = currentLabels.filter(l => l.startsWith('size/'));
            for (const oldLabel of sizeLabels) {
              if (oldLabel !== label) {
                await github.rest.issues.removeLabel({
                  owner: context.repo.owner,
                  repo: context.repo.repo,
                  issue_number: context.issue.number,
                  name: oldLabel,
                });
              }
            }
            
            // Add new size label
            await github.rest.issues.addLabels({
              owner: context.repo.owner,
              repo: context.repo.repo,
              issue_number: context.issue.number,
              labels: [label],
            });
            
            if (total > 1000) {
              core.warning(`‚ö†Ô∏è Bu PR √ßok b√ºy√ºk (${total} satƒ±r). Daha k√º√ß√ºk PR'lara b√∂lmeyi d√º≈ü√ºn√ºn.`);
            }

  pr-labels-check:
    name: üè∑Ô∏è PR Labels Check
    runs-on: ubuntu-latest
    steps:
      - name: Check for labels
        uses: actions/github-script@v7
        with:
          script: |
            const { data: pr } = await github.rest.pulls.get({
              owner: context.repo.owner,
              repo: context.repo.repo,
              pull_number: context.issue.number,
            });
            
            const labels = pr.labels.map(l => l.name);
            const hasTypeLabel = labels.some(l => 
              ['bug', 'enhancement', 'documentation', 'refactor', 'test'].includes(l)
            );
            
            if (!hasTypeLabel) {
              core.warning('‚ö†Ô∏è L√ºtfen PR\'a bir t√ºr etiketi ekleyin (bug, enhancement, vb.)');
            }

  auto-assign-reviewer:
    name: üë§ Auto Assign Reviewer
    runs-on: ubuntu-latest
    steps:
      - name: Auto assign reviewer
        uses: actions/github-script@v7
        with:
          script: |
            const author = context.payload.pull_request.user.login;
            
            // Otomatik reviewer atama (projenize g√∂re d√ºzenleyin)
            const reviewers = ['meertseker'].filter(r => r !== author);
            
            if (reviewers.length > 0) {
              await github.rest.pulls.requestReviewers({
                owner: context.repo.owner,
                repo: context.repo.repo,
                pull_number: context.issue.number,
                reviewers: reviewers,
              });
            }

